var ApplicationConfiguration=function(){"use strict";var e="la-vendimia",t=["ngResource","ngCookies","ngAnimate","ngTouch","ngSanitize","ui.router","ui.bootstrap","ui.utils","LocalStorageModule","naif.base64","angularFileUpload","hc.marked","duScroll","ncy-angular-breadcrumb","angular-growl","localytics.directives","cfp.loadingBar","constantConfig","ngTable","ui.grid","ui.grid.pagination","ui.grid.autoResize","oitozero.ngSweetAlert","ui.tree","mgo-angular-wizard","textAngular","dndLists","ui.calendar","blockUI","chart.js","ui.knob","ui.select"],n=function(t){angular.module(t,[]),angular.module(e).requires.push(t)};return{applicationModuleName:e,applicationModuleVendorDependencies:t,registerModule:n}}();!function(){"use strict";angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$breadcrumbProvider","$httpProvider","$locationProvider","$logProvider","$provide","blockUIConfig","growlProvider","localStorageServiceProvider",function(e,t,n,i,a,o,r,l){var c=0;i.debugEnabled(!0),a.decorator("uibAccordionDirective",["$delegate",function(e){return c=e[0],c.templateUrl="./app/modules/core/views/templates/accordionAce.html",e}]),a.decorator("uibAccordionGroupDirective",["$delegate",function(e){return c=e[0],c.templateUrl="./app/modules/core/views/templates/accordiongroup.html",e}]),a.decorator("uibDaypickerDirective",["$delegate",function(e){return c=e[0],c.templateUrl="./app/modules/core/views/templates/day.html",e}]),a.decorator("uibDatepickerPopupWrapDirective",["$delegate",function(e){return c=e[0],c.templateUrl="./app/modules/core/views/templates/popup.html",e}]),a.decorator("uibYearpickerDirective",["$delegate",function(e){return c=e[0],c.templateUrl="./app/modules/core/views/templates/year.html",e}]),a.decorator("uibMonthpickerDirective",["$delegate",function(e){return c=e[0],c.templateUrl="./app/modules/core/views/templates/month.html",e}]),o.message="Cargando, espere por favor...",o.autoBlock=!1,o.delay=0,o.template='<div class="block-ui-overlay"></div><div class="block-ui-message-container" aria-live="assertive" aria-atomic="true"><div class="block-ui-message" ng-class="$_blockUiMessageClass"><i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i> {{ state.message }}</div></div>',n.hashPrefix("!"),e.setOptions({prefixStateName:"app",templateUrl:"./app/modules/core/views/breadcrumb.view.html"}),r.onlyUniqueMessages(!0),r.messagesKey("mensajes"),r.messageTextKey("mensaje"),r.messageTitleKey("titulo"),r.messageSeverityKey("severidad"),r.globalDisableIcons(!1),r.globalTimeToLive({error:-1,info:3e3,success:3e3,warning:-1}),t.interceptors.push(r.serverMessagesInterceptor),t.interceptors.push("RequestsInterceptor"),l.setStorageType("sessionStorage"),l.setPrefix("cpl.la-vendimia")}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])})}(),function(){"use strict";ApplicationConfiguration.registerModule("core")}(),function(){"use strict";angular.module("core").config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise(function(e){var t=e.get("$state");t.go("app.home")}),e.state("app",{"abstract":!0,views:{root:{templateUrl:"./app/modules/core/views/core.view.html"}}})}])}(),function(){"use strict";angular.module("core").factory("focusElem",["$rootScope","$timeout",function(e,t){return function(n){t(function(){e.$broadcast("coppelFocusOn",n)})}}])}(),function(){"use strict";angular.module("core").factory("requestHuella",["$http","$q","Config",function(e,t,n){var i=function(){return e({method:"GET",url:n.webbridge}).then(function(e){return e.data},function(e){var n={error:"Verificar que se encuentre instalado el servicio de Huella (WebBridge)"};return t.reject(n)})};return{huella:i}}])}(),function(){"use strict";angular.module("core").directive("delayEnter",["$timeout",function(e){return{link:function(t,n,i,a){n.bind("keydown keypress",function(n){13===n.which&&(e(i.delayEnter||500),void 0!==a.$modelValue&&t.$apply(function(){t.$eval(i.delayEnter)}))})},require:"^?ngModel",restrict:"A"}}])}(),function(){"use strict";angular.module("core").directive("focusOn",function(){return function(e,t,n){e.$on("focusOn",function(e,i){i===n.focusOn&&(t[0].focus(),"text"===n.type&&t[0].select())})}})}(),function(){"use strict";angular.module("core").directive("soloLetras",function(){return{link:function(e,t,n,i){var a=function(e){var t="";return e?(t=e.replace(/[^a-zA-Z\s]/g,""),t!==e&&(i.$setViewValue(t),i.$render()),t):""};i.$parsers.push(a)},require:"^?ngModel"}})}(),function(){"use strict";angular.module("core").directive("soloLetrasNumeros",function(){return{link:function(e,t,n,i){var a=function(e){var t="";return e?(t=e.replace(/[^a-zA-ZñÑáéíóúÁÉÍÓÚ^0-9\s]/g,""),t!==e&&(i.$setViewValue(t),i.$render()),t):""};i.$parsers.push(a)},require:"^?ngModel"}})}(),function(){"use strict";angular.module("core").directive("soloNumeros",function(){return{link:function(e,t,n,i){var a=function(e){var t="";return e?(t=e.replace(/(?!^-)[^0-9.]/g,""),t!==e&&(i.$setViewValue(t),i.$render()),t):""};i.$parsers.push(a)},require:"^?ngModel"}})}(),function(){"use strict";angular.module("core").directive("soloNumerosSinPunto",function(){return{link:function(e,t,n,i){var a=function(e){var t="";return e?(t=e.replace(/(?!^-)[^0-9]/g,""),t!==e&&(i.$setViewValue(t),i.$render()),t):""};i.$parsers.push(a)},require:"^?ngModel"}})}(),function(){"use strict";ApplicationConfiguration.registerModule("articulos")}(),function(){"use strict";ApplicationConfiguration.registerModule("clientes")}(),function(){"use strict";ApplicationConfiguration.registerModule("configuracion")}(),function(){"use strict";ApplicationConfiguration.registerModule("home")}(),function(){"use strict";ApplicationConfiguration.registerModule("menu")}(),function(){"use strict";ApplicationConfiguration.registerModule("navbar")}(),function(){"use strict";ApplicationConfiguration.registerModule("niveles")}(),function(){"use strict";ApplicationConfiguration.registerModule("users")}(),function(){"use strict";ApplicationConfiguration.registerModule("ventas")}(),function(){"use strict";angular.module("articulos").config(["$stateProvider",function(e){e.state("app.articulos",{ncyBreadcrumb:{label:"Articulos"},url:"/articulos",views:{"content@app":{controller:"Articulos",controllerAs:"vm",templateUrl:"./app/modules/articulos/views/articulos.view.html"}}})}])}(),function(){"use strict";angular.module("clientes").config(["$stateProvider",function(e){e.state("app.clientes",{ncyBreadcrumb:{label:"Clientes"},url:"/clientes",views:{"content@app":{controller:"Clientes",controllerAs:"vm",templateUrl:"./app/modules/clientes/views/clientes.view.html"}}})}])}(),function(){"use strict";angular.module("configuracion").config(["$stateProvider",function(e){e.state("app.configuracion",{ncyBreadcrumb:{label:"Configuracion"},url:"/configuracion",views:{"content@app":{controller:"Configuracion",controllerAs:"vm",templateUrl:"./app/modules/configuracion/views/configuracion.view.html"}}})}])}(),function(){"use strict";angular.module("home").config(["$stateProvider",function(e){e.state("app.home",{ncyBreadcrumb:{label:" "},url:"/home",views:{"content@app":{controller:"Home",controllerAs:"vmHome",templateUrl:"./app/modules/home/views/home.view.html"}}})}])}(),function(){"use strict";angular.module("niveles").config(["$stateProvider",function(e){e.state("app.niveles",{ncyBreadcrumb:{label:"Niveles"},url:"/niveles"}).state("app.niveles.item1",{ncyBreadcrumb:{label:"Item 1"},url:"/item1",views:{"content@app":{controller:"Niveles",controllerAs:"vmNiveles",templateUrl:"./app/modules/niveles/views/niveles.view.html"}}}).state("app.niveles.item2",{ncyBreadcrumb:{label:"Item 2"},url:"/item2"}).state("app.niveles.item2.detalle",{ncyBreadcrumb:{label:"Detalle"},url:"/detalle",views:{"content@app":{controller:"Niveles",controllerAs:"vmNiveles",templateUrl:"./app/modules/niveles/views/niveles.view.html"}}})}])}(),function(){"use strict";angular.module("users").config(["$stateProvider",function(e){e.state("login",{url:"/login",views:{root:{templateUrl:"./app/modules/users/views/login.view.html"}}})}])}(),function(){"use strict";angular.module("users").run(["$location","$rootScope","$state","$timeout","$window","Authentication","Config","blockUI","growlMessages",function(e,t,n,i,a,o,r,l,c){var s=e.search().token,u="",d="",p=function(){d=t.$on("$stateChangeStart",function(e,i,a){o.isAuth()||"login"===i.name||(t.returnToState=i.name,t.returnToStateParams=a,o.logout(),e.preventDefault()),"login"===i.name&&o.isAuth()===!0&&(n.go("app.home"),e.preventDefault())})};return"Produccion"===r.enviroment&&(l.start(),s?o.loginAutomatico(s).then(function(e){p()}):o.isAuth()?(l.stop(),p()):i(function(){a.location.href=r.redirect})),u=t.$on("$stateChangeSuccess",function(e,n){i(function(){o.isAuth()&&t.$broadcast("autoLogIn"),t.$broadcast("menuRefresh",{state:n})}),c.destroyAllMessages(),e.preventDefault()}),!1}])}(),function(){"use strict";angular.module("ventas").config(["$stateProvider",function(e){e.state("app.ventas",{ncyBreadcrumb:{label:"Ventas"},url:"/ventas",views:{"content@app":{controller:"Ventas",controllerAs:"vm",templateUrl:"./app/modules/ventas/views/ventas.view.html"}}})}])}(),function(){"use strict";angular.module("articulos").factory("Servarticulos",["$http","$q","Config",function(e,t,n){var i=function(){return e({method:"GET",url:n.api+"/articulos"}).then(function(e){return e.data.data.response},function(e){return t.reject(e)})},a=function(){return e({method:"GET",url:n.api+"/idarticulo"}).then(function(e){return e.data.data.response},function(e){return t.reject(e)})},o=function(i,a,o,r,l,c){return e({method:"PUT",url:n.api+"/articulo/"+i+"/"+a+"/"+o+"/"+r+"/"+l+"/"+c}).then(function(e){return e.data.data.response},function(e){return t.reject(e)})},r=function(i){return e({method:"DELETE",url:n.api+"/articulo/"+i}).then(function(e){return e.data.data.response},function(e){return t.reject(e)})};return{consultarArticulos:i,obtenerSiguiente:a,guardarArticulo:o,eliminarArticulo:r}}])}(),function(){"use strict";angular.module("clientes").factory("Servclientes",["$http","$q","Config",function(e,t,n){var i=function(){return e({method:"GET",url:n.api+"/clientes"}).then(function(e){return e.data.data.response},function(e){return t.reject(e)})},a=function(){return e({method:"GET",url:n.api+"/idcliente"}).then(function(e){return e.data.data.response},function(e){return t.reject(e)})},o=function(i,a,o,r,l,c){return e({method:"PUT",url:n.api+"/cliente/"+i+"/"+a+"/"+o+"/"+r+"/"+l+"/"+c}).then(function(e){return e.data.data.response},function(e){return t.reject(e)})},r=function(i){return e({method:"DELETE",url:n.api+"/cliente/"+i}).then(function(e){return e.data.data.response},function(e){return t.reject(e)})};return{consultarClientes:i,consultarIdCliente:a,guardarCliente:o,eliminarCliente:r}}])}(),function(){"use strict";angular.module("configuracion").factory("Servconfig",["$http","$q","Config",function(e,t,n){var i=function(){return e({method:"GET",url:n.api+"/recurso"}).then(function(e){return e.data},function(e){return t.reject(e)})},a=function(){return e({method:"GET",url:n.api+"/configuracion"}).then(function(e){return e.data.data.response},function(e){return t.reject(e)})},o=function(i,a,o,r){return e({method:"PUT",url:n.api+"/configuracion/"+i+"/"+a+"/"+o+"/"+r}).then(function(e){return e.data.data.response},function(e){return t.reject(e)})};return{someMethod:i,cargarConfig:a,guardarConfig:o}}])}(),function(){"use strict";angular.module("menu").factory("servicioMenu",["$http","$q",function(e,t){var n=function(){return e({method:"GET",url:"app/modules/menu/services/menu.json"}).then(function(e){return e.data},function(e){return t.reject(e)})};return{getMenu:n}}])}(),function(){"use strict";angular.module("users").service("Authentication",["$http","$log","$rootScope","$urlRouter","$window","Config","localStorageService",function(e,t,n,i,a,o,r){var l=this,c=function(e,t){l.user=e,l.accessToken=t,r.set("user",e),r.set("access_token",t),n.$broadcast("autoLogIn")},s=function(){l.user=null,l.accessToken=null,r.remove("user","access_token"),a.location.href=o.redirect};l.user=r.get("user"),l.accessToken=r.get("access_token"),this.login=function(e){return!0},this.loginAutomatico=function(n){return e({data:{token:n},method:"POST",url:o.ssoDesarrollo+"/v1/verify"}).then(function(r){return e({data:{token:n},method:"POST",url:o.ssoDesarrollo+"/v1/me"}).then(function(e){i.listen(),t.info(e),c(e.data.data,n)},function(e){a.location.href=o.redirect}),r},function(e){a.location.href=o.redirect})},this.logout=function(){s()},this.isAuth=function(){return!!r.get("access_token")},this.currentUser=function(){return r.get("user")}}])}(),angular.module("users").service("RequestsInterceptor",["$location","$q","Config","localStorageService",function(e,t,n,i){var a=401,o=403,r="";this.request=function(e){return e.url!==n.webbridge&&(r=i.get("access_token"),r&&(e.headers.Authorization=r)),e},this.responseError=function(r){switch(r.status){case a:i.remove("user","access_token"),e.path(n.redirect);break;case o:}return t.reject(r)}}]),function(){"use strict";angular.module("ventas").factory("Servventas",["$http","$q","Config",function(e,t,n){var i=function(){return e({method:"GET",url:n.api+"/ventas"}).then(function(e){return e.data.data.response},function(e){return t.reject(e)})},a=function(){return e({method:"GET",url:n.api+"/folio"}).then(function(e){return e.data.data.response},function(e){return t.reject(e)})},o=function(){return e({method:"GET",url:n.api+"/configuracion"}).then(function(e){return e.data.data.response},function(e){return t.reject(e)})},o=function(){return e({method:"GET",url:n.api+"/configuracion"}).then(function(e){return e.data.data.response},function(e){return t.reject(e)})},r=function(i){return e({method:"GET",url:n.api+"/existencia/"+i}).then(function(e){return e.data.data.response},function(e){return t.reject(e)})},l=function(){return e({method:"GET",url:n.api+"/datoscliente"}).then(function(e){return e.data.data.response},function(e){return t.reject(e)})},c=function(){return e({method:"GET",url:n.api+"/datosarticulo"}).then(function(e){return e.data.data.response},function(e){return t.reject(e)})},s=function(i,a,o){return e({method:"PUT",url:n.api+"/existencia/"+i+"/"+a+"/"+o}).then(function(e){return e.data.data.response},function(e){return t.reject(e)})},u=function(i){return e({method:"PUT",url:n.api+"/venta",data:i}).then(function(e){return e.data.data.response},function(e){return t.reject(e)})},d=function(i){return e({method:"DELETE",url:n.api+"/venta/"+i}).then(function(e){return e.data.data.response},function(e){return t.reject(e)})};return{consultarVentas:i,consultarFolio:a,obtenerConfirugacion:o,validarExistencia:r,actualizarExistencia:s,grabarVenta:u,obtenerDatosCliente:l,obtenerDatosArticulo:c,eliminarVenta:d}}])}(),function(){"use strict";angular.module("menu").directive("coppelMenu",["$rootScope","$state","$timeout",function(e,t,n){return{link:function(i,a){var o="";n(function(){var e=300;a.on("click","li a",function(t){var n=angular.element(this),i=n.next(),a="",o="";i.is(".submenu")&&i.is(":visible")?(i.slideUp(e,function(){i.removeClass("menu-open")}),n.parent().hasClass("active")&&n.parent().removeClass("open")):i.is(".submenu")&&!i.is(":visible")&&(a=n.parents("ul").first(),o=a.find("ul:visible").slideUp(e),o.removeClass("menu-open"),o.parent().hasClass("active")&&o.parent().removeClass("open"),n.parent().hasClass("active")&&n.parent().addClass("open"),i.slideDown(e,function(){i.addClass("menu-open")})),i.is(".submenu")&&t.preventDefault()})}),i.customFilter=function(e,t){var n=0,a=null;if(e.hasOwnProperty("state")&&e.state===t)return e;for(n=0;n<Object.keys(e).length;n++)if(angular.isObject(e[Object.keys(e)[n]])&&(a=i.customFilter(e[Object.keys(e)[n]],t),null!==a))return a;return null},i.collapseAll=function(){var e=0,t=0,n=0;for(e in i.menuData)if(i.menuData[e].show=!1,i.menuData[e].active=!1,i.menuData[e].nodes.length>0)for(t in i.menuData[e].nodes)if(i.menuData[e].nodes[t].show=!1,i.menuData[e].nodes[t].active=!1,i.menuData[e].nodes[t].nodes.length>0)for(n in i.menuData[e].nodes[t].nodes)i.menuData[e].nodes[t].nodes[n].show=!1,i.menuData[e].nodes[t].nodes[n].active=!1},i.handleMenu=function(e){var t=i.customFilter(i.menuData,e),n=e.split(".");3===n.length?t=i.customFilter(i.menuData,"app."+n[1]+"."+n[2]):n.length>3&&(t=i.customFilter(i.menuData,"app."+n[1]+"."+n[2]+"."+n[3])),null!==t&&i.expand(t)},i.expand=function(e){var t=0,n=0,a=0;i.collapseAll();for(t in i.menuData)for(n in i.menuData[t].nodes){if(i.menuData[t].nodes[n].name===e.name){i.menuData[t].active=!0,i.menuData[t].show=!0,e.active=!0;break}if(i.menuData[t].nodes[n].nodes.length>0)for(a in i.menuData[t].nodes[n].nodes)if(i.menuData[t].nodes[n].nodes[a].name===e.name){i.menuData[t].show=!0,i.menuData[t].nodes[n].show=!0,e.active=!0;break}}},o=e.$on("menuRefresh",function(e,n){i.$watch("menuData",function(e){e&&(i.collapseAll(),i.handleMenu(t.current.name))})})},restrict:"E",scope:{menuData:"="},templateUrl:"./app/modules/menu/views/menu.view.html"}}])}(),function(){"use strict";angular.module("users").directive("coppelEnter",[function(){return{link:function(e,t,n,i){t.bind("keydown keypress",function(t){13===t.which&&(angular.isDefined(i.$modelValue)&&e.$apply(function(){e.$eval(n.coppelEnter)}),t.preventDefault())})},require:"^?ngModel"}}])}(),function(){"use strict";angular.module("articulos").controller("Articulos",["Servarticulos","$state","blockUI",function(e,t,n){var i=this,a=e;i.claveArticulo=null,i.descripcion=null,i.modelo=null,i.precio=null,i.existencia=null,i.actualizar=0,i.articulos=[],i.seccionNuevo=!1,i.nomBoton="Guardar";var o=document.getElementById("txtDescripcion"),r=(document.getElementById("txtModelo"),document.getElementById("txtPrecio")),l=document.getElementById("txtExistencia");i.gridOptions={onRegisterApi:function(e){i.gridApi=e},enablePaginationControls:!1,enableFullRowSelection:!1,enableRowSelection:!1,enableSelectAll:!0,selectionRowHeaderWidth:35,enableRowHeaderSelection:!0,enableColumnMenus:!1,enableSorting:!0,enableFiltering:!1,showColumnFooter:!1,columnDefs:[{field:"clave",displayName:"Clave Artículo",width:"10%",headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents center" title="{{row.entity.clave}}" ng-bind-html="row.entity.clave">{{row.entity.clave}}</div>'},{field:"descripcion",displayName:"Descripcion",width:"25%",headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents center" title="{{row.entity.descripcion}}" ng-bind-html="row.entity.descripcion">{{row.entity.descripcion}}</div>'},{field:"modelo",displayName:"Modelo",width:"25%",headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents center" title="{{row.entity.modelo}}" ng-bind-html="row.entity.modelo">{{row.entity.modelo}}</div>'},{field:"precio",displayName:"Precio",width:"15%",headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents center" title="{{row.entity.precio}}" ng-bind-html="row.entity.precio">{{row.entity.precio}}</div>'},{field:"existencia",displayName:"Existencia",width:"15%",headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents center" title="{{row.entity.existencia}}" ng-bind-html="row.entity.existencia">{{row.entity.existencia}}</div>'},{field:"0",displayName:" ",width:"5%",headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents center"> <div class="hidden-sm hidden-xs action-buttons"> <a class="blue" ng-click="grid.appScope.vm.editarArticulo(row)"> <i class="fa fa-edit" style="font-size:25px;color:green" title = "Editar Art&iacute;culo"></i> </a> </div> </div>'},{field:"0",displayName:" ",width:"5%",headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents"> <div class="hidden-sm hidden-xs action-buttons"> <a class="blue" ng-click="grid.appScope.vm.eliminarRenglon(row)"> <i class="fa fa-remove" style="font-size:25px;color:red" title = "Eliminar Art&iacute;culo"></i> </a> </div> </div>'}],data:i.articulos},i.eliminarRenglon=function(e){var t=parseInt(e.entity.clave),n=i.gridApi.grid.renderContainers.body.visibleRowCache.indexOf(e);swal({title:"",text:"¿Está seguro de eliminar el artículo del catálogo?",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-primary",confirmButtonText:"OK",cancelButtonText:"Cancelar",closeOnConfirm:!0,closeOnCancel:!0},function(e){e&&a.eliminarArticulo(t).then(function(e){1!=e.estatus?swal("",e.mensaje,"warning"):(swal("",e.mensaje,"success"),i.articulos.splice(n,1),i.gridOptionsVenta.data=i.articulos)})})},i.consultarArticulos=function(){n.start("Cargando..."),a.consultarArticulos().then(function(e){1!=e.estatus?(swal("",e.mensaje,"warning"),n.stop()):(i.articulos=e.data,i.gridOptions.data=i.articulos,n.stop())},function(e){swal("","Ocurrió un error al conectar con el servicio [consultarArticulos]","error"),n.stop()})},i.consultarArticulos(),i.editarArticulo=function(e){i.nomBoton="Actualizar",i.actualizar=1,i.descripcion=e.entity.descripcion,i.modelo=e.entity.modelo,i.precio=e.entity.precio,i.existencia=e.entity.existencia,i.claveArticulo=e.entity.clave,i.seccionNuevo=!0},i.altaNuevo=function(){i.seccionNuevo=!0,i.descripcion=null,i.modelo=null,i.precio=null,i.existencia=null,i.claveArticulo=null,i.obtenerSiguiente()},i.obtenerSiguiente=function(){a.obtenerSiguiente().then(function(e){1!=e.estatus?swal({title:"",text:e.mensaje,type:"error",showCancelButton:!1,confirmButtonClass:"btn-primary",confirmButtonText:"OK",closeOnConfirm:!0},function(e){e&&i.cancelar()}):(i.claveArticulo=e.data.sig_id,document.getElementById("txtDescripcion").focus())},function(e){swal("","Ocurrió un error al conectar con el servicio [obtenerSiguiente]","error")})},i.validarPrecio=function(){var e=i.precio.length,t=0,n=0;i.precio.length>1&&(t=i.precio.indexOf("."),n=i.precio.lastIndexOf("."),t!=n&&(alert("No puede teclear dos puntos en este control"),i.precio=i.precio.substr(0,e-1)))},i.guardar=function(){var e=parseInt(i.claveArticulo),t=null;t=null==i.modelo?"' '":i.modelo,null==i.descripcion||""==i.descripcion?(alert("No es posible continuar, debe ingresar la Descripción, es obligatorio"),o.focus()):null==i.precio||""==i.precio?(alert("No es posible continuar, debe ingresar el Precio, es obligatorio"),r.focus()):null==i.existencia||""==i.existencia?(alert("No es posible continuar, debe ingresar la Existencia, es obligatorio"),l.focus()):(n.start("Guardando información..."),a.guardarArticulo(i.actualizar,i.descripcion,t,i.precio,i.existencia,e).then(function(e){1!=e.estatus?(swal("",e.mensaje,"warning"),n.stop()):(n.stop(),swal({title:"",text:e.mensaje,type:"success",showCancelButton:!1,confirmButtonClass:"btn-primary",confirmButtonText:"OK",closeOnConfirm:!0},function(e){e&&(i.seccionNuevo=!1,i.consultarArticulos())}))},function(e){n.stop(),swal("","Ocurrió un error al conectar con el servicio [guardar]","error")}))},i.cancelar=function(){i.descripcion=null,i.modelo=null,i.precio=null,i.existencia=null,i.seccionNuevo=!1,i.claveArticulo=null,i.articulos=[],i.actualizar=0,i.nomBoton="Guardar",i.consultarArticulos()}}])}(),function(){"use strict";angular.module("clientes").controller("Clientes",["SweetAlert","Servclientes","blockUI",function(e,t,n){var i=this,a=t;i.seccionNuevo=!1,i.claveCliente=null,i.nomBoton="Guardar",i.nombre=null,i.apPaterno=null,i.apMaterno=null,i.rfc=null,i.clientes=[],i.actualizar=0,i.gridOptions={onRegisterApi:function(e){i.gridApi=e},enablePaginationControls:!1,enableFullRowSelection:!1,enableRowSelection:!1,enableSelectAll:!0,selectionRowHeaderWidth:35,enableRowHeaderSelection:!0,enableColumnMenus:!1,enableSorting:!0,enableFiltering:!1,showColumnFooter:!1,columnDefs:[{field:"clave",displayName:"Clave Cliente",width:"10%",headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents center" title="{{row.entity.clave}}" ng-bind-html="row.entity.clave">{{row.entity.clave}}</div>'},{field:"nombre",displayName:"Nombre",width:"30%",headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents center" title="{{row.entity.nombre}}" ng-bind-html="row.entity.nombre">{{row.entity.nombre}}</div>'},{field:"appaterno",displayName:"Apellido Paterno",width:"20%",headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents center" title="{{row.entity.appaterno}}" ng-bind-html="row.entity.appaterno">{{row.entity.appaterno}}</div>'},{field:"apmaterno",displayName:"Apellido Materno",width:"15%",headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents center" title="{{row.entity.apmaterno}}" ng-bind-html="row.entity.apmaterno">{{row.entity.apmaterno}}</div>'},{field:"rfc",displayName:"RFC",width:"15%",headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents center" title="{{row.entity.rfc}}" ng-bind-html="row.entity.rfc">{{row.entity.rfc}}</div>'},{field:"0",displayName:" ",width:"5%",headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents center"> <div class="hidden-sm hidden-xs action-buttons"> <a class="blue" ng-click="grid.appScope.vm.editarCliente(row)"> <i class="fa fa-edit" style="font-size:25px;color:green" title = "Editar Cliente"></i> </a> </div> </div>'},{field:"0",displayName:" ",width:"5%",headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents"> <div class="hidden-sm hidden-xs action-buttons"> <a class="blue" ng-click="grid.appScope.vm.eliminarRenglon(row)"> <i class="fa fa-remove" style="font-size:25px;color:red" title = "Eliminar Cliente"></i> </a> </div> </div>'}],data:i.clientes},i.eliminarRenglon=function(e){var t=parseInt(e.entity.clave),n=i.gridApi.grid.renderContainers.body.visibleRowCache.indexOf(e);swal({title:"",text:"¿Está seguro de eliminar al cliente del catálogo?",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-primary",confirmButtonText:"OK",cancelButtonText:"Cancelar",closeOnConfirm:!0,closeOnCancel:!0},function(e){e&&a.eliminarCliente(t).then(function(e){1!=e.estatus?swal("",e.mensaje,"warning"):(swal("",e.mensaje,"success"),i.clientes.splice(n,1),i.gridOptionsVenta.data=i.clientes)},function(e){swal("","Ocurrió un error al conectar con el servicio [eliminarRenglon]","error")})})},i.consultarClientes=function(){n.start("Cargando..."),a.consultarClientes().then(function(e){1!=e.estatus?(swal("",e.mensaje,"warning"),n.stop()):(i.clientes=e.data,i.gridOptions.data=i.clientes,n.stop())},function(e){swal("","Ocurrió un error al conectar con el servicio [consultarEmpleados]","error"),n.stop()})},i.consultarClientes(),i.consultarId=function(){a.consultarIdCliente().then(function(e){1!=e.estatus?swal({title:"",text:e.mensaje,type:"error",showCancelButton:!1,confirmButtonClass:"btn-primary",confirmButtonText:"OK",closeOnConfirm:!0},function(e){e&&i.cancelar()}):i.claveCliente=e.data.sig_id},function(e){swal("","Ocurrió un error al conectar con el servicio [consultarId]","error")})},i.altaNuevo=function(){i.seccionNuevo=!0,i.nombre=null,i.apPaterno=null,i.apMaterno=null,i.rfc=null,i.nomBoton="Guardar",i.consultarId()},i.guardar=function(){var e=parseInt(i.claveCliente);null==i.nombre||""==i.nombre?(alert("No es posible continuar, debe ingresar la Nombre, es obligatorio"),document.getElementById("txtNombre").focus()):null==i.apPaterno||""==i.apPaterno?(alert("No es posible continuar, debe ingresar el Apellido Paterno, es obligatorio"),document.getElementById("txtApPaterno").focus()):null==i.rfc||""==i.rfc?(alert("No es posible continuar, debe ingresar el RFC, es obligatorio"),document.getElementById("txtRFC").focus()):null==i.apMaterno||""==i.apMaterno?document.getElementById("txtApMaterno").focus():(n.start("Guardando información..."),a.guardarCliente(i.actualizar,i.nombre,i.apPaterno,i.apMaterno,i.rfc,e).then(function(e){1!=e.estatus?(swal("",e.mensaje,"warning"),n.stop()):(n.stop(),swal({title:"",text:e.mensaje,type:"success",showCancelButton:!1,confirmButtonClass:"btn-primary",confirmButtonText:"OK",closeOnConfirm:!0},function(e){e&&(i.seccionNuevo=!1,i.consultarClientes())}))},function(e){n.stop(),swal("","Ocurrió un error al conectar con el servicio [guardar]","error")}))},i.editarCliente=function(e){i.nomBoton="Actualizar",i.actualizar=1,i.nombre=e.entity.nombre,i.apPaterno=e.entity.appaterno,i.apMaterno=e.entity.apmaterno,i.rfc=e.entity.rfc,i.claveCliente=e.entity.clave,i.seccionNuevo=!0},i.cancelar=function(){i.nombre=null,i.apPaterno=null,i.apMaterno=null,i.rfc=null,i.seccionNuevo=!1,i.claveCliente=null,i.clientes=[],i.actualizar=0,i.nomBoton="Guardar",i.consultarClientes()}}])}(),function(){"use strict";angular.module("configuracion").controller("Configuracion",["Servconfig","SweetAlert","$state","blockUI",function(e,t,n,i){var a=this,o=e;a.tasa=null,a.porcentaje=null,a.plazo=null,a.estatus=null,o.cargarConfig().then(function(e){i.start("Cargando..."),1!=e.estatus?(document.getElementById("txtTasaFinanciamiento").focus(),a.estatus=-1,i.stop()):(a.tasa=e.data.tasa,a.porcentaje=e.data.porcentaje,a.plazo=e.data.plazo,a.estatus=1,i.stop())},function(e){swal("","Ocurrió un error al conectar con el servicio [cargarConfig]","error"),i.stop()}),a.guardar=function(){null==a.tasa&&null==a.porcentaje&&null==a.plazo?swal("","No se ha capturado ninguna configuración, favor de revisar","warning"):(i.start("Guardando información..."),null!=a.tasa&&""!=a.tasa||(a.tasa=0),null!=a.porcentaje&&""!=a.porcentaje||(a.porcentaje=0),null!=a.plazo&&""!=a.plazo||(a.plazo=0),o.guardarConfig(a.estatus,a.tasa,a.porcentaje,a.plazo).then(function(e){1!=e.estatus?(i.stop(),swal("",e.mensaje,"error")):(i.stop(),swal("",e.mensaje,"success"))},function(e){i.stop(),swal("","Ocurrió un error al conectar con el servicio [guardarConfig]","error")}))},a.cancelar=function(){n.go("app.home")}}])}(),function(){"use strict";angular.module("home").controller("Home",[function(){var e=this;e.titulo="Titulo"}])}(),function(){"use strict";angular.module("menu").controller("Menu",["$rootScope","$scope","servicioMenu",function(e,t,n){var i=this;i.collapseMenu=!0,i.toggleMenu=function(){i.collapseMenu=!i.collapseMenu},i.isLoginScreen=!1,n.getMenu().then(function(t){i.tree=t.data.menu,e.$broadcast("menuRefresh")}),t.$on("toggleMenu",function(e,t){i.displayMenu=t})}])}(),function(){"use strict";angular.module("navbar").controller("Header",["$rootScope","$scope","Authentication","Config","blockUI",function(e,t,n,i,a){var o=this;o.hojaAzul=i.hojaAzul,o.btnToggler=!1,o.isCollapsed=!1,o.isLoginScreen=!1,o.usuario={},o.fecha=new Date,o.dia=o.fecha.getDate(),o.mes=o.fecha.getMonth()+1,o.anio=o.fecha.getFullYear(),o.fecActual=o.dia+"/"+o.mes+"/"+o.anio,o.fecActual=moment(o.fecActual).format("MM/DD/YYYY"),t.$on("autoLogIn",function(e,t){o.usuario=n.currentUser(),a.stop()}),o.toggleCollapsibleMenu=function(){o.isCollapsed=!o.isCollapsed},t.$on("$stateChangeSuccess",function(e,t,n,i,a){o.isCollapsed=!1,o.isLoginScreen=!1,"login"===t.name&&(o.isLoginScreen=!0)}),o.toggleMenu=function(){o.btnToggler=!o.btnToggler,e.$broadcast("toggleMenu",o.btnToggler)},o.logout=function(){n.logout()}}])}(),function(){"use strict";angular.module("niveles").controller("Niveles",[function(){var e=this;e.info=""}])}(),function(){"use strict";angular.module("users").controller("Authentication",["$scope","Authentication",function(e,t){var n=this;n.user={},n.alerts=[],n.addAlert=function(e){n.alerts.push({msg:e,type:"danger"})},n.closeAlert=function(e){n.alerts.splice(e,1)},n.login=function(){
t.login(e.user)}}])}(),function(){"use strict";angular.module("ventas").controller("Ventas",["Servventas","SweetAlert","Config","$scope","blockUI","$state",function(e,t,n,i,a,o){var r=this,l=e;r.nombreCliente=null,r.clienteSelecto=null,r.articuloSelecto=null,r.ventas=[],r.plazos=[3,6,9,12],r.tablaAbonos=[],r.configuracion=[],r.registroVentas=[],r.enganche=0,r.bonifEnganche=0,r.totalPagar=0,r.nombreBoton="Siguiente",r.totalAdeudo=0,r.precioContado=0,r.claveCliente=null,r.nomCliente=null,r.plazoSeleccionado=null,r.abonoSeleccionado=null,r.ahorroSeleccionado=null,r.totalPagarSelecc=null,r.unidades=null,r.claveArticulo=null,r.datosCliente=[],r.datosArticulo=[],r.rfcCliente=null,r.verRFC=!1,r.verTabla=!1,r.seccionNuevo=!1,r.guardar=!1,r.folioVenta=null,r.deshabilCliente=!1,r.deshabilitaArticulo=!0,r.gridOptions={onRegisterApi:function(e){r.gridApi=e},enablePaginationControls:!1,enableFullRowSelection:!1,enableRowSelection:!1,enableSelectAll:!0,selectionRowHeaderWidth:35,enableRowHeaderSelection:!0,enableColumnMenus:!1,enableSorting:!0,enableFiltering:!1,showColumnFooter:!1,columnDefs:[{field:"folio",displayName:"Folio Venta",width:"10%",headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents center" title="{{row.entity.folio}}" ng-bind-html="row.entity.folio">{{row.entity.folio}}</div>'},{field:"clavecliente",displayName:"Clave Cliente",width:"10%",headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents center" title="{{row.entity.clavecliente}}" ng-bind-html="row.entity.clavecliente">{{row.entity.clavecliente}}</div>'},{field:"nombre",displayName:"Nombre",width:"35%",headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents center" title="{{row.entity.nombre}}" ng-bind-html="row.entity.nombre">{{row.entity.nombre}}</div>'},{field:"total",displayName:"Total",width:"20%",headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents center" title="{{row.entity.total}}" ng-bind-html="row.entity.total">{{row.entity.total}}</div>'},{field:"fecha",displayName:"Fecha",width:"15%",headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents center" title="{{row.entity.fecha}}" ng-bind-html="row.entity.fecha">{{row.entity.fecha}}</div>'},{field:"0",displayName:" ",width:"5%",headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents"> <div class="hidden-sm hidden-xs action-buttons"> <a class="blue" ng-click="grid.appScope.vm.verDetalle(row)"> <i class="fa fa-list-alt" style="font-size:25px;color:green" title = "Ver Detalle"></i> </a> </div> </div>'},{field:"0",displayName:" ",width:"5%",headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents"> <div class="hidden-sm hidden-xs action-buttons"> <a class="blue" ng-click="grid.appScope.vm.eliminarRenglonVenta(row)"> <i class="fa fa-remove" style="font-size:25px;color:red" title = "Eliminar Venta"></i> </a> </div> </div>'}],data:r.ventas},r.gridOptionsVenta={onRegisterApi:function(e){r.gridApiVenta=e},enablePaginationControls:!1,enableFullRowSelection:!1,enableRowSelection:!1,enableSelectAll:!0,selectionRowHeaderWidth:35,enableRowHeaderSelection:!0,enableColumnMenus:!1,enableSorting:!0,enableFiltering:!1,showColumnFooter:!1,columnDefs:[{field:"id",displayName:"Clave",width:"8%",headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents center" title="{{row.entity.id}}" ng-bind-html="row.entity.id">{{row.entity.id}}</div>'},{field:"descripcion",displayName:"Descripción del Artículo",width:"25%",headerCellClass:"text-center",cellClass:"text-left",cellTemplate:'<div class="ui-grid-cell-contents left" title="{{row.entity.descripcion}}" ng-bind-html="row.entity.descripcion">{{row.entity.descripcion}}</div>'},{field:"modelo",displayName:"Modelo",width:"25%",headerCellClass:"text-center",cellClass:"text-left",cellTemplate:'<div class="ui-grid-cell-contents left" title="{{row.entity.modelo}}" ng-bind-html="row.entity.modelo">{{row.entity.modelo}}</div>'},{field:"cantidad",displayName:"Cantidad",width:"10%",headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents center"> <input type="text" id="txtCantidad" ng-model="row.entity.cantidad" ng-change="grid.appScope.vm.calcularImporte(row)" solo-numeros maxlength="3"> </div>'},{field:"precio",displayName:"Precio",width:"13%",headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents center" title="{{row.entity.precio}}" ng-bind-html="row.entity.precio">{{row.entity.precio}}</div>'},{field:"importe",displayName:"Importe",width:"14%",headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents center" title="{{row.entity.importe}}" ng-bind-html="row.entity.importe">{{row.entity.importe}}</div>'},{field:"0",displayName:" ",width:"5%",headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents"> <div class="hidden-sm hidden-xs action-buttons"> <a class="blue" ng-click="grid.appScope.vm.eliminarRenglon(row)"> <i class="fa fa-remove" style="font-size:25px;color:red" title = "Eliminar Art&iacute;culo"></i> </a> </div> </div>'}],data:r.registroVentas},r.eliminarRenglonVenta=function(e){var t=parseInt(e.entity.folio),n=r.gridApi.grid.renderContainers.body.visibleRowCache.indexOf(e);swal({title:"",text:"¿Está seguro de eliminar la venta del registro del catálogo?",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-primary",confirmButtonText:"OK",cancelButtonText:"Cancelar",closeOnConfirm:!0,closeOnCancel:!0},function(e){a.start("Cargando..."),e&&l.eliminarVenta(t).then(function(e){1!=e.estatus?(swal("",e.mensaje,"warning"),a.stop()):(swal("",e.mensaje,"success"),r.ventas.splice(n,1),r.gridOptionsVenta.data=r.ventas,a.stop())},function(e){a.stop(),swal("","Ocurrió un error al conectar con el servicio [eliminarRenglon]","error")})})},r.cambiaSelectCliente=function(){r.deshabilCliente=!0;var e=document.getElementById("cmbClientes").selectedIndex;r.rfcCliente=r.datosCliente[e].rfc,r.nomCliente=r.datosCliente[e].nombre,r.verRFC=!0,r.deshabilitaArticulo=!1,document.getElementById("cmbArticulos").focus()},r.cambiaSelectArticulo=function(){},r.agregarArticulo=function(){if(r.articuloSelecto.length>0&&0==r.deshabilitaArticulo){a.start("Cargando...");for(var e=0;e<r.articuloSelecto.length;e++){var t=r.articuloSelecto[e];r.validarExistencia(t)}r.deshabilitaArticulo=!0}},r.verDetalle=function(e){r.modalFolio=e.entity.folio,r.modalCliente=e.entity.clavecliente,r.modalNombre=e.entity.nombre,r.modalTotal=e.entity.total,r.modalFecha=e.entity.fecha,r.modalPlazo=e.entity.plazo,r.modalAbono=e.entity.abono,r.modalTotalPagar=e.entity.totalpagar,r.modalAhorro=e.entity.ahorro,$(document).ready(function(){$("#modalDetalle").modal({show:!0})})},r.obtenerDatosCliente=function(){l.obtenerDatosCliente().then(function(e){1!=e.estatus?swal("",e.mensaje,"warning"):r.datosCliente=e.data},function(e){swal("","Ocurrió un error al conectar con el servicio [obtenerDatosCliente]","error")})},r.obtenerDatosArticulo=function(){l.obtenerDatosArticulo().then(function(e){1!=e.estatus?swal("",e.mensaje,"warning"):r.datosArticulo=e.data},function(e){swal("","Ocurrió un error al conectar con el servicio [obtenerDatosArticulo]","error")})},r.obtenerConfirugacion=function(){a.start("Cargando..."),l.obtenerConfirugacion().then(function(e){1!=e.estatus?(swal("","No se han configurado los datos para el cálculo del monto, favor de verificar"),a.stop()):(r.configuracion=e.data,a.stop())},function(e){a.stop(),swal({title:"",text:"Ocurrió un error al conectar con el servicio [obtenerConfigucacion]",type:"error",showCancelButton:!1,confirmButtonClass:"btn-primary",confirmButtonText:"OK",closeOnConfirm:!0},function(e){e&&o.go("app.home")})})},r.consultarVentas=function(){a.start("Cargando..."),l.consultarVentas().then(function(e){1!=e.estatus?(swal("",e.mensaje,"warning"),a.stop()):(r.ventas=e.data,r.gridOptions.data=r.ventas,a.stop())},function(e){a.stop(),swal("","Ocurrió un error al conectar con el servicio [consultarVentas]","error")})},r.consultarVentas(),r.consultarFolio=function(){l.consultarFolio().then(function(e){1!=e.estatus?swal("",e.mensaje,"warning"):r.folioVenta=e.data.sig_folio},function(e){swal({title:"",text:"Ocurrió un error al conectar con el servicio [consultarFolio]",type:"error",showCancelButton:!1,confirmButtonClass:"btn-primary",confirmButtonText:"OK",closeOnConfirm:!0},function(e){e&&o.go("app.home")})})},r.nuevaVenta=function(){r.seccionNuevo=!0,r.deshabilCliente=!1,r.deshabilitaArticulo=!0,r.consultarFolio(),r.obtenerConfirugacion(),r.obtenerDatosCliente(),r.obtenerDatosArticulo()},r.calcularImporte=function(e){var t=r.gridApiVenta.core.getVisibleRows(r.gridApiVenta.grid),n=null,i=null,a=null;r.verTabla=!1,r.guardar=!1,r.nombreBoton="Siguiente",r.tablaAbonos=[],parseInt(e.entity.cantidad)>parseInt(e.entity.existencia)?(e.entity.cantidad="",e.entity.importe=0,swal({title:"",text:"No puede capturar mas unidades de las que hay en existencia ("+e.entity.existencia+")",type:"warning",showCancelButton:!1,confirmButtonClass:"btn-primary",confirmButtonText:"OK",closeOnConfirm:!0},function(t){t&&(r.actualizarExistencia(e.entity.id,e.entity.unidadesAnterior,1),e.entity.unidadesAnterior=0)})):0!=parseInt(e.entity.cantidad)&&e.entity.cantidad.length>0?(r.unidades=parseInt(e.entity.cantidad),r.unidadesAnt=parseInt(e.entity.unidadesAnterior),e.entity.importe=(e.entity.cantidad*e.entity.precio).toFixed(2),r.unidades>n?(i=r.unidades-r.unidadesAnt,r.actualizarExistencia(e.entity.id,i,0),e.entity.unidadesAnterior=r.unidades):r.unidades<n&&(a=n-r.unidades,r.actualizarExistencia(e.entity.id,a,1),e.entity.unidadesAnterior=r.unidades)):t.length>1?(e.entity.importe=0,r.calcularTotales(),r.actualizarExistencia(e.entity.id,e.entity.unidadesAnterior,1),e.entity.unidadesAnterior=0):(r.enganche=0,r.bonifEnganche=0,r.totalPagar=0,e.entity.importe=0)},r.calcularTotales=function(){for(var e=0,t=r.gridApiVenta.core.getVisibleRows(r.gridApiVenta.grid),n=0;n<t.length;n++)e+=parseFloat(t[n].entity.importe);r.enganche=r.configuracion.porcentaje/100*e,r.bonifEnganche=r.enganche*(r.configuracion.tasa*r.configuracion.plazo/100),r.totalPagar=e-r.enganche-r.bonifEnganche,r.totalAdeudo=r.totalPagar.toFixed(2),r.bonifEnganche=r.bonifEnganche.toLocaleString("us",{minimumFractionDigits:2,maximumFractionDigits:2}),r.enganche=r.enganche.toLocaleString("us",{minimumFractionDigits:2,maximumFractionDigits:2}),r.totalPagar=r.totalPagar.toLocaleString("us",{minimumFractionDigits:2,maximumFractionDigits:2})},r.validarExistencia=function(e){l.validarExistencia(e).then(function(e){1!=e.estatus?(swal("",e.mensaje,"warning"),a.stop()):(r.registroVentas.push(e.data[0]),r.gridOptionsVenta.data=r.registroVentas,a.stop())},function(e){a.stop(),swal("","Ocurrió un error al conectar con el servicio [validarExistencia]","error"),r.cancelar()})},r.eliminarRenglon=function(e){var t=r.gridApiVenta.grid.renderContainers.body.visibleRowCache.indexOf(e);r.registroVentas.splice(t,1),r.gridOptionsVenta.data=r.registroVentas,r.actualizarExistencia(e.entity.id,e.entity.unidadesAnterior,1),r.calcularTotales()},r.siguienteGuardar=function(){var e=r.gridApiVenta.core.getVisibleRows(r.gridApiVenta.grid),t=null,n=!0;if("Siguiente"==r.nombreBoton){for(var i=0;i<e.length;i++)t=e[i].entity.cantidad,0!=parseInt(t)&&0!=t.length||(n=!1);n?(r.formarObjetoTabla(),r.verTabla=!0,r.nombreBoton="Guardar"):swal("","Los datos ingresados no son correctos, favor de verificar","warning")}else if(r.guardar){a.start("Guardando información...");var o={};o.claveCliente=parseInt(r.clienteSelecto[0]),o.nombre=r.nomCliente,o.totalAdeudo=r.totalAdeudo,o.plazo=r.plazoSeleccionado,o.abono=r.abonoSeleccionado,o.totalPagar=r.totalPagarSelecc,o.ahorrro=r.ahorroSeleccionado,l.grabarVenta(o).then(function(e){1!=e.estatus?(a.stop(),swal("",e.mensaje,"warning")):(swal({title:"",text:"Bien hecho, Tu venta ha sido registrada correctamente",type:"success",showCancelButton:!1,confirmButtonClass:"btn-primary",confirmButtonText:"OK",closeOnConfirm:!0},function(e){e&&r.inicializar()}),a.stop())},function(e){a.stop(),swal("","Ocurrió un error al conectar con el servicio [siguienteGrabar]","error")})}else swal("","Debe seleccionar un plazo para realizar el pago de su compra","warning")},r.actualizarExistencia=function(e,t,n){a.start("Cargando..."),l.actualizarExistencia(e,t,n).then(function(e){1!=e.estatus?(swal("",e.mensaje,"warning"),a.stop()):(r.calcularTotales(),a.stop())},function(e){a.stop(),swal("","Ocurrió un error al conectar con el servicio [actualizarExistencia]")})},r.formarObjetoTabla=function(){var e=0;r.precioContado=(r.totalAdeudo/(1+r.configuracion.tasa*r.configuracion.plazo/100)).toFixed(2);for(var t=0;t<r.plazos.length;t++){var n=r.plazos[t],i={};e=(r.precioContado*(1+r.configuracion.tasa*n/100)).toFixed(2),i.plazo=n,i.abono=(e/n).toFixed(2),i.totalPagar=e,i.ahorra=(r.totalAdeudo-e).toFixed(2),r.tablaAbonos.push(i)}},r.validarPlazo=function(e){r.guardar=!0,r.plazoSeleccionado=r.tablaAbonos[e].plazo,r.abonoSeleccionado=r.tablaAbonos[e].abono,r.ahorroSeleccionado=r.tablaAbonos[e].ahorra,r.totalPagarSelecc=r.tablaAbonos[e].totalPagar},r.cancelar=function(){var e=r.gridApiVenta.core.getVisibleRows(r.gridApiVenta.grid),t=0;if(r.nombreBoton="Siguiente",r.verTabla=!1,r.seccionNuevo=!1,r.verRFC=!1,r.clienteSelecto=null,r.articuloSelecto=null,e.length>0)for(var n=0;n<e.length;n++)t=parseInt(e[n].entity.unidadesAnterior),e[n].entity.unidadesAnterior>0&&r.actualizarExistencia(e[n].entity.id,t,1),n==e.length-1&&(r.registroVentas=[],r.gridOptionsVenta.data=r.registroVentas,r.consultarVentas());r.bonifEnganche=0,r.enganche=0,r.totalPagar=0},r.inicializar=function(){r.nombreBoton="Siguiente",r.verTabla=!1,r.seccionNuevo=!1,r.verRFC=!1,r.clienteSelecto=null,r.articuloSelecto=null,r.bonifEnganche=0,r.enganche=0,r.totalPagar=0,r.registroVentas=[],r.gridOptionsVenta.data=r.registroVentas,r.consultarVentas()}}])}();